(this["webpackJsonpblueberry-jam"]=this["webpackJsonpblueberry-jam"]||[]).push([[0],{102:function(e,t,a){},103:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(19),o=a.n(r),l=a(21),s=(a(60),a(10)),c=a(12),h=(a(61),a(8)),u=a(11),m=a(14),d=a(13),p=a(15),f=a(1),g=function(){function e(t){Object(h.a)(this,e),this.speed=-100,this.frametime=0,this.previousFrameTime=0,this.scene=new f.k,this.ambientLight=new f.a(16777215),this.scene.add(this.ambientLight),this.camera=new f.i(45,window.innerWidth/window.innerHeight,10,2e4),this.camera.position.set(6e3,7e3,500),this.camera.rotateX(.2*Math.PI),this.camera.up=new f.n(0,0,1),this.renderer=new f.o,this.renderer.setClearColor(new f.c(.5,.6,.8),1),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(window.devicePixelRatio),t.ref.appendChild(this.renderer.domElement),this.resizeHandler=this.resizeHandler.bind(this),window.addEventListener("resize",this.resizeHandler,!1),this.keyboardHandler=this.keyboardHandler.bind(this),window.addEventListener("keydown",this.keyboardHandler,!1);var a=new f.j(12800,12800,1024,1024),n=new f.h,i=(new f.m).load(t.textureMap||"./data/91250-6973750.png");n.displacementMap=i,n.displacementScale=t.displacementScale||2e3;var r=(new f.m).load(t.imageMap||"./data/91250-6973750.jpg");n.map=r;var o=new f.e(a,n);o.position.set(t.groundPosX||6400,t.groundPosY||6400,t.groundPosZ||0),this.scene.add(o),this.animate=this.animate.bind(this),this.animate()}return Object(u.a)(e,[{key:"animate",value:function(e){this.frametime=e-this.previousFrameTime||0,this.previousFrameTime=e,requestAnimationFrame(this.animate);var t=new f.n;this.camera.getWorldDirection(t),this.camera.position.addScaledVector(t,this.speed*this.frametime*.001),this.renderer.render(this.scene,this.camera)}},{key:"resizeHandler",value:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}},{key:"keyboardHandler",value:function(e){switch(e.key){case"ArrowDown":this.camera.rotateX(.05);break;case"ArrowUp":this.camera.rotateX(-.05);break;case"ArrowLeft":this.camera.rotateZ(.05);break;case"ArrowRight":this.camera.rotateZ(-.05);break;case"q":this.speed+=50;break;case"a":this.speed-=50;break;case"z":this.camera.rotateY(.05);break;case"x":this.camera.rotateY(-.05)}}}]),e}(),w=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(m.a)(this,Object(d.a)(t).call(this,e))).mapRef=i.a.createRef(),a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){new g({ref:this.mapRef.current,displacementScale:200,imageMap:"./data/team1.png",textureMap:"./data/team1_bw.png"})}},{key:"render",value:function(){return i.a.createElement("div",{ref:this.mapRef}," ")}}]),t}(n.Component),E=a(18),v=a(49),b=a(2);function y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function x(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?y(a,!0).forEach((function(t){Object(b.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var k=[91250,6973750],j=[{id:"sweden",minX:6e5,maxX:8e5,minY:64e5,maxY:67e5,scale:6e3,text:"Russian submarine"},{id:"norway",minX:91250,maxX:1e5,minY:6973750,maxY:71e5,scale:2e3,text:"Molde"},{id:"denmark",minX:306148,maxX:33e4,minY:6170538,maxY:62e5,scale:2e3,text:"Roskilde"}],O=50,C=256*O;function A(e){var t,a=Object(E.a)(e,2),n=a[0],i=a[1],r=!0,o=!1,l=void 0;try{for(var s,c=j[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var h=s.value;h.minX<=n&&n<=h.maxX&&h.minY<=i&&i<=h.maxY&&(t=h)}}catch(u){o=!0,l=u}finally{try{r||null==c.return||c.return()}finally{if(o)throw l}}return{x:n-(n-t.minX)%(255*O),y:i-(i-t.minY)%(255*O),tileset:t}}var R=function(){function e(t,a){Object(h.a)(this,e),this.speed=0,this.frametime=0,this.previousFrameTime=0,this.scene=new f.k,this.ambientLight=new f.a(16777215),this.scene.add(this.ambientLight),this.camera=new f.i(45,window.innerWidth/window.innerHeight,10,4e4),this.camera.position.set(5e3,5e3,1e3),this.camera.rotateX(Math.PI/2),this.camera.up=new f.n(0,0,1),this.renderer=new f.o;var n=new f.c(.5,.6,.8);this.renderer.setClearColor(n,1),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.createHorizon(n),t.current.appendChild(this.renderer.domElement),this.resizeHandler=this.resizeHandler.bind(this),window.addEventListener("resize",this.resizeHandler,!1),this.keyboardHandler=this.keyboardHandler.bind(this),window.addEventListener("keydown",this.keyboardHandler,!1);var i=A(a||k);if(this.generateTiles(i),a){var r=function(e,t){var a=Object(E.a)(e,2),n=a[0],i=a[1];return{x:n-t.x,y:i-t.y}}(a,i);this.createSign(r,i.tileset.text),this.camera.lookAt(new f.n(r.x,r.y,0))}this.animate=this.animate.bind(this),this.animate()}return Object(u.a)(e,[{key:"createHorizon",value:function(e){var t=new f.j(10*C,10*C),a=new f.g({color:new f.c(.45,.5,.7)}),n=new f.e(t,a);n.position.set(0,0,-100),this.scene.add(n);var i=C,r=3*C;this.scene.fog=new f.d(e,i,r)}},{key:"generateTiles",value:function(e){this.createTile(e,{x:0,y:0});for(var t=0,a=[-1,0,1];t<a.length;t++)for(var n=a[t],i=0,r=[-1,0,1];i<r.length;i++){var o=r[i];0===n&&0===o||this.createTile(x({},e,{x:e.x+n*O*255,y:e.y+o*O*255}),{x:n,y:o})}}},{key:"createTile",value:function(e,t){var a=this,n=new f.j(C,C,256,256),i=new f.h,r=(new f.m).load("./data/".concat(e.x,"-").concat(e.y,".png"));i.displacementMap=r,i.displacementScale=e.tileset.scale;var o=new f.e(n,i),l=t.x*C+C/2,s=t.y*C+C/2;o.position.set(l,s,0),(new f.m).load("./data/".concat(e.x,"-").concat(e.y,".jpg"),(function(e){i.map=e,i.fog=!1,a.scene.add(o)}),void 0,void 0)}},{key:"createSign",value:function(e,t){var a=e;this.text=t;this.textureCanvas=document.createElement("canvas"),this.ctx=this.textureCanvas.getContext("2d"),this.textureCanvas.width=512,this.textureCanvas.height=256,this.ctx.clearRect(0,0,this.textureCanvas.width,this.textureCanvas.height),this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.textureCanvas.width,this.textureCanvas.height),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="white",this.ctx.font="bold 40px Helvetica",this.ctx.fillText(this.text,this.textureCanvas.width/2,this.textureCanvas.height/2);var n=this.ctx.measureText(this.text).width+60;n<140&&(n+=20),this.ctx.lineWidth=8,this.ctx.strokeStyle="white",this.ctx.strokeRect(this.textureCanvas.width/2-n/2,this.textureCanvas.height/2-33,n,66);var i=new f.l(this.textureCanvas);i.needsUpdate=!0;var r=new f.j(1024,512),o=new f.f;o.transparent=!0,o.map=i,o.alphaMap=i;var l=new f.e(r,o);l.position.set(a.x,a.y,500),l.up=new f.n(0,0,1),l.lookAt(this.camera.position.x,this.camera.position.y,l.position.z),this.scene.add(l);var s=new f.b(14,14,500),c=new f.h({color:16777215}),h=new f.e(s,c);h.position.set(a.x,a.y,176),this.scene.add(h)}},{key:"animate",value:function(e){this.frametime=e-this.previousFrameTime||0,this.previousFrameTime=e,requestAnimationFrame(this.animate);var t=new f.n;this.camera.getWorldDirection(t),this.camera.position.addScaledVector(t,this.speed*this.frametime*.001),this.renderer.render(this.scene,this.camera)}},{key:"resizeHandler",value:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}},{key:"keyboardHandler",value:function(e){switch(e.key){case"ArrowDown":this.camera.rotateX(.05);break;case"ArrowUp":this.camera.rotateX(-.05);break;case"ArrowLeft":this.camera.rotateZ(.05);break;case"ArrowRight":this.camera.rotateZ(-.05);break;case"q":this.speed+=50;break;case"a":this.speed-=50;break;case"z":this.camera.rotateY(.05);break;case"x":this.camera.rotateY(-.05)}}}]),e}(),S=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(m.a)(this,Object(d.a)(t).call(this,e))).mapRef=i.a.createRef(),a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e,t=new URLSearchParams(window.location.search).get("gps");if(t){var a=t.split(",").map((function(e){return parseFloat(e)})),n=Object(E.a)(a,2),i=n[0],r=n[1];e=Object(v.a)("EPSG:4326","+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ").forward([r,i]).map((function(e){return Math.round(e)}))}new R(this.mapRef,e)}},{key:"render",value:function(){return i.a.createElement("div",{ref:this.mapRef}," ")}}]),t}(n.Component);a(62);var T=function(){return i.a.createElement("div",null,i.a.createElement("div",{className:"InstructionsPage"},i.a.createElement("div",{className:"InstructionsPage_inner"},i.a.createElement("h1",null,"Do it yourself"),i.a.createElement("h2",null,"How to prepare data files"),i.a.createElement("ol",null,i.a.createElement("li",null,"Download height data (from your local mapping agency, probably)."),i.a.createElement("li",null,"Download satellite data (from your local mapping agency, or"," ",i.a.createElement("a",{href:"https://apps.sentinel-hub.com/eo-browser/"},"ESA"),").")),i.a.createElement("h2",null,"Working with GDAL"),i.a.createElement("ul",null,i.a.createElement("li",null,"Extract only the region you are interested in."),i.a.createElement("li",null,"Make satellite and height data match (i.e. cover the same area)."),i.a.createElement("li",null,"Use GDAL to convert the height data to a simple format (e.g. PNG) for presentation in the browser."),i.a.createElement("li",null,"Convert the satellite data to simple format (e.g. JPG) for presentation in the browser.")),i.a.createElement("h2",null,"Introduction to GDAL"),i.a.createElement("ul",null,i.a.createElement("li",null,"GDAL can convert and manipulate all kinds of geographical data."),i.a.createElement("li",null,"Download GDAL ",i.a.createElement("a",{href:"https://gdal.org/download.html#binaries"},"here"),"."),i.a.createElement("li",null,"To get an overview of all the programs contained inside GDAL check"," ",i.a.createElement("a",{href:"https://gdal.org/programs/index.html"},"here"),"."),i.a.createElement("li",null,"It can read ",i.a.createElement("strong",null,"many")," ",i.a.createElement("a",{href:"https://gdal.org/drivers/raster/index.html"},"data formats"),".")),i.a.createElement("h2",null,"Tips"),i.a.createElement("ul",null,i.a.createElement("li",null,"Use ",i.a.createElement("strong",null,"gdalinfo")," to extract information about files, and to see whether GDAL can understand the file."),i.a.createElement("li",null,"Use ",i.a.createElement("strong",null,"gdal_translate")," to extract a given region from a large file.")),i.a.createElement("h2",null,"Using GDAL - part 1"),i.a.createElement("ul",null,i.a.createElement("li",null,"Here is an example of a full command line converting a GeoTIFF height data file to a png file:"),i.a.createElement("p",null,i.a.createElement("strong",null,"gdal_translate -of png -ot Byte -scale 0 2550 0 255 -srcwin start_x_coordinate start_y_coordinate num_output_pixels_x num_output_pixels_y input.tif output.png"))),i.a.createElement("h2",null,"Explanation of the parameters"),i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement("strong",null,"-of png")," is there to tell gdal that the output file will be a png."),i.a.createElement("li",null,i.a.createElement("strong",null,"-ot Byte")," is there to restrict the height data to 1 byte per height value. This is to ensure that we end up with a png that store height values in the range of 0 to 255. Ie an 8-bit png file."),i.a.createElement("li",null,i.a.createElement("strong",null,"-scale 0 2550 0 255")," is there to map the input heights (in this case: in the range from 0 to 2550 meters) to an output range (of 0 to 255). This in order to match the range limitations of an 8-bit png file."),i.a.createElement("li",null,i.a.createElement("strong",null,"-srcwin start_x_coordinate start_y_coordinate num_output_pixels_x num_output_pixels_y tells")," ","where to start extracting height values (using the coordinate system that the source file is using), and how many height values to extract in the x and y direction."),i.a.createElement("li",null,i.a.createElement("strong",null,"input.tif")," the input file name."),i.a.createElement("li",null,i.a.createElement("strong",null,"output.png")," the output file name.")),i.a.createElement("h2",null,"Using GDAL - part 2"),i.a.createElement("ul",null,i.a.createElement("li",null,"To use matching satellite imagery, first download a Sentinel zip"," ",i.a.createElement("a",{href:"https://apps.sentinel-hub.com/eo-browser/"},"file"),". Unzip the file. There should be a subdirectory called GRANULE there. Go there, and to its subdirectory (having a long, cryptic name, like L1C_T33UUB_A013819_20191029T102039), and go to the IMG_DATA subdirectory beneath it."),i.a.createElement("li",null,"The file that ends with TCI.jp2 has the natural color information. This is a file in JPEG2000 format, something which GDAL unfortunately is not able to read."),i.a.createElement("li",null,"A solution could be to try to convert the jp2 file to a different file format (for example GeoTIFF) and read out the projection information (the text which is shown when you use `gdalinfo` on a file). The Preview application is macOS can read the jp2 file and write a TIFF file. And then apply the projection information onto the TIFF file."),i.a.createElement("li",null,"The idea is then to extract the extents information from the height data source file and reapply the same extents information onto the satellite data file. This way they will match. `gdal_translate` and the `-projwin ` option should be used to crop the input image to spesific geographical coordinates."),i.a.createElement("li",null,"We did not succeed in extracting and matching raw Sentinel data."),i.a.createElement("li",null,"Final note: The satellite image size should preferably be somewhat higher than the height map - for example 1024 by 1024 pixels. We did not succeed in extracting and matching raw Sentinel data.")))))},_=(a(63),a(42)),D=a.n(_),H=a(43),P=a.n(H),L=a(44),z=a.n(L);var G=function(){return i.a.createElement("div",null,i.a.createElement("div",{className:"HomePage"},i.a.createElement("div",{className:"HomePage_inner"},i.a.createElement("h1",null,"Experience the magic of Nordic Earth"),i.a.createElement("p",null,"Nordic Earth gives you the power to generate 3D images from ortographic photos. By combining topographic data with satelite images you can generate awesome 3D images. You can pan around in the 3D universe and explore points of interest."),i.a.createElement("h2",null,"What is it"),i.a.createElement("ul",null,i.a.createElement("li",null,"As a journalist, you can use this expert tool to generate 3D image from a point of interest."),i.a.createElement("li",null,"You can also make cool CGI panoramic content for your videos or articles.")),i.a.createElement("h3",null,"Combining topographical data"),i.a.createElement("img",{alt:"height map gif",src:z.a}),i.a.createElement("h2",null,"Meet the geniuses behind this project"),i.a.createElement("img",{alt:"geniuses 1",src:D.a}),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement(s.b,{to:"/bonusmap"},i.a.createElement("img",{alt:"geniuses 2",src:P.a})))))};a(65);var F=function(){return i.a.createElement("div",null,i.a.createElement("div",{className:"KeyCommandsPage"},i.a.createElement("div",{className:"KeyCommandsPage_inner"},i.a.createElement("h1",null,"Key commands for the map"),i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement("p",null,"\u2191 tilts the camera down")),i.a.createElement("li",null,i.a.createElement("p",null,"\u2193 tilts the camera up")),i.a.createElement("li",null,i.a.createElement("p",null,"\u2190 rotates the camera counter-clockwise")),i.a.createElement("li",null,i.a.createElement("p",null,"\u2192 rotates the camera clockwise")),i.a.createElement("li",null,"q zooms in"),i.a.createElement("li",null,"a zooms out"),i.a.createElement("li",null,"z rotates the camera left"),i.a.createElement("li",null,"x rotates the camera right")))))},I=a(47),N=a.n(I),M="/",Y="/diy",W="/keys",X="/maps",U="/bonusmap",B=function(e){return e.coordinatesState.coordinates},q=function(e){return e.coordinatesState.isLoading},Z=a(28),J=a.n(Z),K={getAll:function(){return J.a.get("/api/coordinates").then((function(e){return e.data}))},getCoordinateWithId:function(e){return J.a.get("".concat("/api/coordinates","/").concat(e)).then((function(e){return e.data}))}},V=function(e){return e.navigationState.currentRoute},Q=function(e){return e.navigationState.previousRoute};a(102);function $(e){var t=e.coordinates,a=e.isLoading,r=e.setCoordinates,o=e.navigate,l=e.currentRoute,c=e.history,h=e.previousRoute;Object(n.useEffect)((function(){K.getAll().then((function(e){r(e)}))}),[]);var u=function(e){o(e,l)},m={backgroundColor:"#FFF",color:"#000"},d=![M,Y,W].includes(l);return i.a.createElement("div",{className:"header"},i.a.createElement("h1",null,"NORDIC EARTH"),d&&i.a.createElement("div",{className:"top_navigation_links"},i.a.createElement("button",{type:"button",onClick:function(){u(h),c.goBack()}},"Exit map")),!d&&i.a.createElement("div",{className:"top_navigation_links"},i.a.createElement(s.b,{style:l===M?m:{},to:M,onClick:function(){return u(M)}},"Home"),i.a.createElement(s.b,{style:l===Y?m:{},to:Y,onClick:function(){return u(Y)}},"DIY"),i.a.createElement(s.b,{style:l===W?m:{},to:W,onClick:function(){return u(W)}},"Keys"),a&&i.a.createElement(N.a,{className:"loader",type:"TailSpin",color:"#00BFFF",height:40,width:40}),!a&&t.map((function(e){return i.a.createElement(s.b,{style:l===e.locationName?m:{},key:e.id,to:"".concat(X,"?gps=").concat(e.gps),onClick:function(){return u(X)}},e.locationName)}))))}$.defaultProps={previousRoute:null};var ee=Object(l.b)((function(e){return{coordinates:B(e),isLoading:q(e),currentRoute:V(e),previousRoute:Q(e)}}),(function(e){return{setCoordinates:function(t){return e(function(e){return{type:"GET_COORDINATES_SUCCESS",coordinates:e}}(t))},navigate:function(t,a){return e(function(e,t){return{type:"NAVIGATE",nextRoute:e,previousRoute:t}}(t,a))}}}))($),te=Object(c.e)(ee);var ae=function(){return i.a.createElement("div",{className:"App"},i.a.createElement(s.a,null,i.a.createElement(te,null),i.a.createElement(c.a,{exact:!0,path:M,component:G}),i.a.createElement(c.a,{path:Y,component:T}),i.a.createElement(c.a,{path:W,component:F}),i.a.createElement(c.a,{path:X,component:S}),i.a.createElement(c.a,{path:U,component:w})))},ne=a(17),ie=a(48),re={coordinates:[],isLoading:!0},oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_COORDINATES_SUCCESS":return{coordinates:t.coordinates,isLoading:!1};default:return e}},le={currentRoute:M,previousRoute:null},se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:le,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"NAVIGATE":return{currentRoute:t.nextRoute,previousRoute:t.previousRoute};default:return e}},ce=Object(ne.c)({coordinatesState:oe,navigationState:se}),he=Object(ne.d)(ce,Object(ne.a)(ie.a)),ue=document.getElementById("root");o.a.render(i.a.createElement(l.a,{store:he},i.a.createElement(ae,null)),ue)},42:function(e,t,a){e.exports=a.p+"static/media/team1.c532b920.png"},43:function(e,t,a){e.exports=a.p+"static/media/team2.fb70ccd0.png"},44:function(e,t,a){e.exports=a.p+"static/media/hm-wireframe.eda51d57.gif"},50:function(e,t,a){e.exports=a(103)},60:function(e,t,a){},61:function(e,t,a){},62:function(e,t,a){},63:function(e,t,a){},65:function(e,t,a){}},[[50,1,2]]]);
//# sourceMappingURL=main.f5d52e3c.chunk.js.map